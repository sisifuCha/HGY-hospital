# ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—

## 5åˆ†é’Ÿå¿«é€Ÿå¯¼å…¥æ•°æ®

### å‰ææ¡ä»¶
```bash
# 1. ç¡®ä¿PostgreSQL 17å·²å®‰è£…å¹¶è¿è¡Œ
psql --version  # åº”è¯¥æ˜¾ç¤º PostgreSQL 17.x

# 2. åˆ›å»ºæ•°æ®åº“
createdb -U postgres hospital_db

# 3. åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
psql -U postgres -d hospital_db -f hospital_register_postgresql_17.sql
```

### æ–¹å¼ä¸€ï¼šä¸€é”®å¯¼å…¥ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# ç¡®ä¿CSVæ–‡ä»¶åœ¨å½“å‰ç›®å½•ä¸‹
cd /mnt/user-data/outputs

# æ‰§è¡Œå¯¼å…¥ï¼ˆä½¿ç”¨å›ºå®šè·¯å¾„è„šæœ¬ï¼‰
psql -U postgres -d hospital_db -f import_data.sql

# æŸ¥çœ‹ç»“æœ
psql -U postgres -d hospital_db -c "SELECT * FROM show_import_statistics();"
```

### æ–¹å¼äºŒï¼šè‡ªå®šä¹‰è·¯å¾„å¯¼å…¥ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# 1. å°†CSVæ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®
cp department.csv /path/to/your/data/
cp title_number_source.csv /path/to/your/data/
cp doctor_info.csv /path/to/your/data/

# 2. ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°å¯¼å…¥
psql -U postgres -d hospital_db \
  -v department_csv_path="'/path/to/your/data/department.csv'" \
  -v title_csv_path="'/path/to/your/data/title_number_source.csv'" \
  -v doctor_csv_path="'/path/to/your/data/doctor_info.csv'" \
  -f import_data_config.sql
```

### æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨é€æ­¥å¯¼å…¥

```bash
# è¿æ¥æ•°æ®åº“
psql -U postgres -d hospital_db

# åœ¨psqlä¸­æ‰§è¡Œ
SELECT import_department_data('/path/to/department.csv');
SELECT import_title_data('/path/to/title_number_source.csv');
SELECT import_doctor_data('/path/to/doctor_info.csv');
SELECT * FROM show_import_statistics();
```

## âœ… éªŒè¯å¯¼å…¥ç»“æœ

### 1. å¿«é€Ÿæ£€æŸ¥
```sql
-- æŸ¥çœ‹å¯¼å…¥ç»Ÿè®¡
SELECT * FROM show_import_statistics();

-- åº”è¯¥çœ‹åˆ°ï¼š
-- ç§‘å®¤æ•°é‡: 22
-- åŒ»ç”Ÿæ•°é‡: 369
-- è¯Šå®¤æ•°é‡: 18
```

### 2. æŸ¥çœ‹åŒ»ç”Ÿä¿¡æ¯
```sql
-- æŸ¥çœ‹å‰10ä½åŒ»ç”Ÿ
SELECT * FROM v_doctor_detail LIMIT 10;

-- æŸ¥çœ‹ä¸»ä»»åŒ»å¸ˆ
SELECT doctor_name, department_name, ori_cost 
FROM v_doctor_detail 
WHERE title_name = 'ä¸»ä»»åŒ»å¸ˆ';
```

### 3. æŒ‰ç§‘å®¤æŸ¥çœ‹
```sql
-- æŸ¥çœ‹å¿ƒå†…ç§‘åŒ»ç”Ÿ
SELECT doctor_name, title_name, ori_cost 
FROM v_doctor_detail 
WHERE department_name = 'å¿ƒå†…ç§‘é—¨è¯Š'
ORDER BY ori_cost DESC;
```

## ğŸ“Š å¸¸ç”¨æŸ¥è¯¢

```sql
-- 1. å„ç§‘å®¤åŒ»ç”Ÿç»Ÿè®¡
SELECT 
    parent_department_name as çˆ¶ç§‘å®¤,
    department_name as ç§‘å®¤,
    COUNT(*) as åŒ»ç”Ÿæ•°
FROM v_doctor_detail
GROUP BY parent_department_name, department_name
ORDER BY åŒ»ç”Ÿæ•° DESC;

-- 2. èŒç§°åˆ†å¸ƒ
SELECT 
    title_name as èŒç§°,
    COUNT(*) as äººæ•°,
    AVG(ori_cost) as å¹³å‡æŒ‚å·è´¹
FROM v_doctor_detail
GROUP BY title_name
ORDER BY AVG(ori_cost) DESC;

-- 3. æ‰¾å‡ºæŒ‚å·è´¹æœ€è´µçš„åŒ»ç”Ÿ
SELECT 
    doctor_name as å§“å,
    title_name as èŒç§°,
    department_name as ç§‘å®¤,
    ori_cost as æŒ‚å·è´¹
FROM v_doctor_detail
ORDER BY ori_cost DESC
LIMIT 10;
```

## ğŸ” æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

```sql
-- æ‰§è¡Œå®Œæ•´æ€§æ£€æŸ¥
SELECT 'æ£€æŸ¥é¡¹' as æ£€æŸ¥ç±»å‹, 'ç»“æœ' as æ£€æŸ¥ç»“æœ
UNION ALL
SELECT 'åŒ»ç”Ÿ-ç”¨æˆ·å…³è”',
    CASE WHEN COUNT(*) = 0 THEN 'âœ“ é€šè¿‡'
         ELSE 'âœ— å‘ç°' || COUNT(*) || 'ä¸ªé—®é¢˜' END
FROM doctor d LEFT JOIN "user" u ON d.id = u.id WHERE u.id IS NULL
UNION ALL
SELECT 'åŒ»ç”Ÿ-è¯Šå®¤å…³è”',
    CASE WHEN COUNT(*) = 0 THEN 'âœ“ é€šè¿‡'
         ELSE 'âœ— å‘ç°' || COUNT(*) || 'ä¸ªé—®é¢˜' END
FROM doctor d LEFT JOIN clinic c ON d.clinic_ID = c.id WHERE c.id IS NULL
UNION ALL
SELECT 'åŒ»ç”Ÿ-èŒç§°å…³è”',
    CASE WHEN COUNT(*) = 0 THEN 'âœ“ é€šè¿‡'
         ELSE 'âœ— å‘ç°' || COUNT(*) || 'ä¸ªé—®é¢˜' END
FROM doctor d LEFT JOIN title_number_source t ON d.doc_title_ID = t.id WHERE t.id IS NULL;
```

## ğŸ¯ é¢„æœŸç»“æœ

å¯¼å…¥æˆåŠŸåï¼Œæ‚¨åº”è¯¥æ‹¥æœ‰ï¼š

### æ•°æ®è§„æ¨¡
- âœ… 22ä¸ªç§‘å®¤ï¼ˆ4ä¸ªçˆ¶ç§‘å®¤ + 18ä¸ªå­ç§‘å®¤ï¼‰
- âœ… 4ç§èŒç§°ç­‰çº§é…ç½®
- âœ… 18ä¸ªè¯Šå®¤ï¼ˆæ¯ä¸ªå­ç§‘å®¤ä¸€ä¸ªï¼‰
- âœ… 369ä½åŒ»ç”Ÿç”¨æˆ·
- âœ… 369æ¡åŒ»ç”Ÿè®°å½•

### åŒ»ç”ŸèŒç§°åˆ†å¸ƒ
- âœ… ä¸»ä»»åŒ»å¸ˆï¼š18äººï¼ˆ4.9%ï¼‰- æŒ‚å·è´¹Â¥200
- âœ… å‰¯ä¸»ä»»åŒ»å¸ˆï¼š55äººï¼ˆ14.9%ï¼‰- æŒ‚å·è´¹Â¥100
- âœ… ä¸»æ²»åŒ»å¸ˆï¼š110äººï¼ˆ29.8%ï¼‰- æŒ‚å·è´¹Â¥50
- âœ… ä½é™¢åŒ»å¸ˆï¼š186äººï¼ˆ50.4%ï¼‰- æŒ‚å·è´¹Â¥20

### é»˜è®¤è´¦å·ä¿¡æ¯
æ¯ä¸ªåŒ»ç”Ÿéƒ½æœ‰ï¼š
- ğŸ“§ é‚®ç®±ï¼š`{åŒ»ç”ŸID}@hospital.com`
- ğŸ‘¤ è´¦å·ï¼š`doc_{åŒ»ç”ŸID}`
- ğŸ”’ å¯†ç ï¼šMD5åŠ å¯†çš„ `{åŒ»ç”ŸID}password`
- ğŸ“± æ‰‹æœºï¼šéšæœºç”Ÿæˆçš„138å¼€å¤´å·ç 

**ç¤ºä¾‹åŒ»ç”Ÿè´¦å·**ï¼š
```
åŒ»ç”ŸID: DOC0001
å§“å: ä¸è£æ™¶
é‚®ç®±: DOC0001@hospital.com
è´¦å·: doc_DOC0001
å¯†ç : MD5(DOC0001password)
```

## âŒ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: æ–‡ä»¶ä¸å­˜åœ¨
```
ERROR: could not open file for reading
```
**è§£å†³**ï¼šæ£€æŸ¥CSVæ–‡ä»¶è·¯å¾„ï¼Œç¡®ä¿PostgreSQLè¿›ç¨‹æœ‰è¯»å–æƒé™

### é”™è¯¯2: ç¼–ç é”™è¯¯
```
ERROR: invalid byte sequence for encoding "UTF8"
```
**è§£å†³**ï¼šç¡®ä¿CSVæ–‡ä»¶ä½¿ç”¨UTF-8ç¼–ç ï¼ˆé¡¹ç›®ç”Ÿæˆçš„CSVå·²ç»æ˜¯UTF-8ï¼‰

### é”™è¯¯3: æƒé™ä¸è¶³
```
ERROR: permission denied
```
**è§£å†³**ï¼š
```bash
# ç»™PostgreSQLç”¨æˆ·è¯»å–æƒé™
chmod 644 *.csv
# æˆ–å°†æ–‡ä»¶ç§»åˆ°PostgreSQLå¯è®¿é—®çš„ç›®å½•
mv *.csv /tmp/
```

### é”™è¯¯4: è¡¨ä¸å­˜åœ¨
```
ERROR: relation "department" does not exist
```
**è§£å†³**ï¼šå…ˆæ‰§è¡Œæ•°æ®åº“schemaåˆ›å»ºè„šæœ¬
```bash
psql -U postgres -d hospital_db -f hospital_register_postgresql_17.sql
```

## ğŸ”„ é‡æ–°å¯¼å…¥

å¦‚æœéœ€è¦é‡æ–°å¯¼å…¥ï¼ˆæ¸…ç©ºæ—§æ•°æ®ï¼‰ï¼š

```sql
-- æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆæŒ‰é¡ºåºï¼Œé¿å…å¤–é”®å†²çªï¼‰
TRUNCATE TABLE 
    add_number_source_record,
    alternate_record,
    blacklist,
    cancel_record,
    doc_schedule_change_record,
    register_record,
    pay_record,
    sensitive_operation,
    doc_schedule_record,
    doctor,
    patient,
    "user",
    clinic,
    schedule_template,
    title_number_source,
    department,
    medical_insurance,
    reimburse_type
CASCADE;

-- ç„¶åé‡æ–°æ‰§è¡Œå¯¼å…¥è„šæœ¬
\i import_data.sql
```

## ğŸ“š è¿›ä¸€æ­¥å­¦ä¹ 

- ğŸ“– å®Œæ•´æ–‡æ¡£ï¼š`README_å¯¼å…¥è¯´æ˜.md`
- ğŸ” ç¤ºä¾‹æŸ¥è¯¢ï¼š`sample_queries.sql`
- ğŸ“Š é¡¹ç›®æ¦‚è¿°ï¼š`é¡¹ç›®äº¤ä»˜æ–‡æ¡£.md`

## ğŸ‰ å®Œæˆï¼

æ­å–œï¼æ‚¨å·²æˆåŠŸå¯¼å…¥369ä½åŒ»ç”Ÿçš„æ•°æ®åˆ°åŒ»é™¢æŒ‚å·ç³»ç»Ÿã€‚

**ä¸‹ä¸€æ­¥å»ºè®®**ï¼š
1. æµè§ˆ `sample_queries.sql` äº†è§£æ›´å¤šæŸ¥è¯¢ç¤ºä¾‹
2. æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ·»åŠ æ‚£è€…æ•°æ®
3. åˆ›å»ºåŒ»ç”Ÿæ’ç­è®°å½•
4. å¼€å‘æŒ‚å·åŠŸèƒ½

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹ `README_å¯¼å…¥è¯´æ˜.md` ä¸­çš„æ•…éšœæ’é™¤éƒ¨åˆ†
